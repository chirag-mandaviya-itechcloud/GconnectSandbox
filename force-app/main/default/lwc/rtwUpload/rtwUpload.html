<template>
    <div class = "connect-v2">
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         SINGLE MODE  â€“  British / Irish Passport
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <template if:true={isSingleMode}>
        <div class="main">

            <div>
                <h1 class="page-title">Upload your Right to Work evidence</h1>
                <p class="page-subtitle">Please upload a clear photo of your document.</p>
                <div class="doc-badge">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                        <rect x="2" y="4" width="20" height="16" rx="2"/>
                        <circle cx="12" cy="11" r="3"/>
                    </svg>
                    {documentType}
                </div>
            </div>

            <template if:true={showResubmissionNotice}>
                <div class="resubmission-notice">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="8" x2="12" y2="12"/>
                        <line x1="12" y1="16" x2="12.01" y2="16"/>
                    </svg>
                    <div>Your previous submission wasn't suitable. Please upload a new, clear photo.</div>
                </div>
            </template>

            <!-- Illustration card -->
            <div class="custom-card">
                <div class="card-body">
                    <div class="illustration-section">
                        <div class="illustration-box good">
                            <div class="illustration-label good-label">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                                    <circle cx="12" cy="12" r="10"/><path d="M8 12l3 3 5-5"/>
                                </svg>
                                Good
                            </div>
                            <div class="passport-illustration passport-good">
                                <div class="passport-crest">ðŸ‘‘</div>
                                <div class="passport-photo-area">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="rgba(255,255,255,0.4)" stroke="none">
                                        <circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 4-7 8-7s8 3 8 7"/>
                                    </svg>
                                </div>
                                <div class="passport-lines">
                                    <div class="passport-line"></div>
                                    <div class="passport-line short"></div>
                                </div>
                                <div class="passport-mrz">
                                    <div class="mrz-line"></div><div class="mrz-line"></div>
                                </div>
                            </div>
                            <div class="illustration-hint">Full page visible, clear and sharp</div>
                        </div>
                        <div class="illustration-box bad">
                            <div class="illustration-label bad-label">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                                    <circle cx="12" cy="12" r="10"/>
                                    <line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/>
                                </svg>
                                Not accepted
                            </div>
                            <div class="passport-illustration passport-bad">
                                <div class="passport-crest"></div>
                                <div class="passport-photo-area"></div>
                                <div class="passport-lines">
                                    <div class="passport-line"></div><div class="passport-line"></div>
                                </div>
                            </div>
                            <div class="illustration-hint">Blurry, cropped, or hard to read</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Guidelines card -->
            <div class="custom-card">
                <div class="card-body">
                    <div class="guidelines-title">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--connect-green)" stroke-width="2" stroke-linecap="round">
                            <rect x="3" y="3" width="18" height="18" rx="2"/><path d="M8 12l3 3 5-5"/>
                        </svg>
                        Photo guidelines
                    </div>
                    <template for:each={guidelines} for:item="g">
                        <div key={g} class="guideline-item">
                            <div class="guideline-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                                    <path d="M5 12l5 5L20 7"/>
                                </svg>
                            </div>
                            <div class="guideline-text">{g}</div>
                        </div>
                    </template>
                </div>
            </div>

            <!-- Upload / Preview card -->
            <div class="custom-card">
                <div class="card-body upload-card-body">

                    <!-- â•â• FILE ALREADY UPLOADED â€“ show preview â•â• -->
                    <template if:true={hasFrontFile}>
                        <template for:each={frontFilesList} for:item="file">
                            <div key={file.id} class="preview-card">
                                <!-- Image preview -->
                                <template if:true={file.isImage}>
                                    <img src={file.preview} class="preview-img" alt={file.name} />
                                </template>
                                <!-- PDF / non-image -->
                                <template if:false={file.isImage}>
                                    <div class="pdf-preview">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round">
                                            <path d="M13 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V9z"/>
                                            <polyline points="13 2 13 9 20 9"/>
                                        </svg>
                                    </div>
                                </template>
                                <div class="preview-info">
                                    <div class="preview-name">{file.name}</div>
                                    <div class="preview-size">{file.fileSize}</div>
                                    <div class="preview-type-badge">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" style="width:10px;height:10px">
                                            <path d="M5 12l5 5L20 7"/>
                                        </svg>
                                        Uploaded successfully
                                    </div>
                                </div>
                                <button class="remove-btn" onclick={delFrontFile} data-index={file.id} title="Remove">âœ•</button>
                            </div>
                        </template>
                    </template>

                    <!-- â•â• NO FILE YET â€“ show upload zone â•â• -->
                    <template if:false={hasFrontFile}>

                        <!-- Camera view -->
                        <template if:true={showCamera}>
                            <!-- <button onclick={closeCamera}>Close</button> -->
                            <div class="camera-wrap">
                                <video autoplay playsinline></video>
                                <button onclick={closeCamera}
                                    class="camera-close-btn"
                                    title="Close camera">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" style="width:14px;height:14px">
                                        <line x1="18" y1="6" x2="6" y2="18"/>
                                        <line x1="6" y1="6" x2="18" y2="18"/>
                                    </svg>
                                </button>
                                <template if:true={showCaptureIcon}>
                                    <button class="snap-btn" onclick={takePhoto}></button>
                                    <button class="swap-btn" onclick={handleCameraSwap}>
                                        <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round">
                                            <path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/>
                                            <circle cx="12" cy="13" r="4"/>
                                        </svg>
                                    </button>
                                </template>
                                <canvas class="slds-hide"></canvas>
                            </div>
                        </template>

                        <!-- Upload zone (hidden when camera open) -->
                        <template if:false={showCamera}>
                            <div class="upload-zone-wrapper">
                                <div class="upload-zone-content">
                                    <div class="upload-icon">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                                            <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                                            <polyline points="17 8 12 3 7 8"/>
                                            <line x1="12" y1="3" x2="12" y2="15"/>
                                        </svg>
                                    </div>
                                    <div class="upload-text-primary"><span>Choose a file</span></div>
                                    <div class="upload-text-secondary">JPG, PNG â€” max 5 MB</div>
                                </div>
                                <!-- Invisible overlay input -->
                                <input class="file-input-overlay" type="file" accept=".jpg,.jpeg,.png,.pdf" onchange={handleFileUploadChange} />
                            </div>

                            <div class="divider-row">
                                <div class="divider-line"></div>
                                <span class="divider-or">or</span>
                                <div class="divider-line"></div>
                            </div>

                            <div style="display:flex;justify-content:center;">
                                <button class="capture-btn-full capture-btn indented" onclick={captureImage}>
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" style="width:18px;height:18px;flex-shrink:0">
                                        <path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/>
                                        <circle cx="12" cy="13" r="4"/>
                                    </svg>
                                    Take a photo
                                </button>
                            </div>
                        </template>
                    </template>

                </div>
            </div>
        </div>
    </template>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         DUAL MODE  â€“  Certificate + NI
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <template if:true={isDualMode}>
        <div class="dual-main">

            <div>
                <div class="page-title">Upload your evidence</div>
                <div class="page-subtitle">You need to upload two documents to prove your right to work.</div>
                <div class="doc-badge">{documentType}</div>
            </div>

            <!-- â”€â”€ Document 1: Certificate â”€â”€ -->
            <div class="card">
                <div class="card-body">
                    <div class="section-header">
                        <div class="section-num">1</div>
                        <div class="section-title">{certificateLabel}</div>
                    </div>

                    <template if:true={showCertificateWarning}>
                        <div class="warning-callout">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" style="width:15px;height:15px;flex-shrink:0">
                                <path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/>
                                <line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>
                            </svg>
                            <div>Must be a <strong>full certificate</strong> showing at least one parent's name.</div>
                        </div>
                    </template>

                    <!-- Preview if file uploaded -->
                    <template if:true={hasFrontFile}>
                        <template for:each={frontFilesList} for:item="file">
                            <div key={file.id} class="uploaded-file-row">
                                <template if:true={file.isImage}>
                                    <img src={file.preview} class="preview-thumb-sm" alt={file.name} />
                                </template>
                                <template if:false={file.isImage}>
                                    <div class="uploaded-file-icon">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round">
                                            <path d="M13 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V9z"/>
                                            <polyline points="13 2 13 9 20 9"/>
                                        </svg>
                                    </div>
                                </template>
                                <div class="uploaded-file-info">
                                    <div class="uploaded-file-name">{file.name}</div>
                                    <div class="uploaded-file-size">{file.fileSize}</div>
                                </div>
                                <button class="remove-btn" onclick={delFrontFile} data-index={file.id}>âœ•</button>
                            </div>
                        </template>
                    </template>

                    <!-- Upload zone if no file -->
                    <template if:false={hasFrontFile}>
                        <template if:true={showFrontCamera}>
                            <div class="camera-wrap">
                                <video autoplay playsinline></video>
                                  <button onclick={closeCamera}
                                    class="camera-close-btn"
                                    title="Close camera">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" style="width:14px;height:14px">
                                        <line x1="18" y1="6" x2="6" y2="18"/>
                                        <line x1="6" y1="6" x2="18" y2="18"/>
                                    </svg>
                                </button>
                                <template if:true={showCaptureIcon}>
                                    <button class="snap-btn" onclick={takeFrontPhoto}></button>
                                    <button class="swap-btn" onclick={handleCameraSwap}>
                                        <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round">
                                            <path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/>
                                            <circle cx="12" cy="13" r="4"/>
                                        </svg>
                                    </button>
                                </template>
                                <canvas class="slds-hide"></canvas>
                            </div>
                        </template>
                        <template if:false={showFrontCamera}>
                            <div class="upload-zone-wrapper indented">
                                <div class="upload-zone-content small">
                                    <div class="upload-icon-sm">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                                            <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                                            <polyline points="17 8 12 3 7 8"/>
                                            <line x1="12" y1="3" x2="12" y2="15"/>
                                        </svg>
                                    </div>
                                    <div class="upload-text-primary sm"><span>Choose a file</span></div>
                                    <div class="upload-text-secondary">JPG, PNG â€” max 5 MB</div>
                                </div>
                                <input class="file-input-overlay" type="file" accept=".jpg,.jpeg,.png,.pdf" onchange={handleFileUploadChange} />
                            </div>
                            <div class="or-row indented">
                                <div class="divider-line"></div>
                                <span class="divider-or">or</span>
                                <div class="divider-line"></div>
                            </div>
                            <div style="display:flex;justify-content:center;">
                                <button class="capture-btn indented" onclick={captureFrontImage}>
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" style="width:13px;height:13px">
                                        <path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/>
                                        <circle cx="12" cy="13" r="4"/>
                                    </svg>
                                    Take a photo
                                </button>
                            </div>
                        </template>
                    </template>
                </div>
            </div>

            <!-- â”€â”€ Document 2: NI Proof â”€â”€ -->
            <div class="card">
                <div class="card-body">
                    <div class="section-header">
                        <div class="section-num">2</div>
                        <div class="section-title">National Insurance proof</div>
                    </div>
                    <div class="ni-hint">
                        <strong>Accepted:</strong> P45, P60, HMRC letter, previous PAYE payslip, or DWP letter.
                    </div>

                    <!-- Preview if file uploaded -->
                    <template if:true={hasBackFile}>
                        <template for:each={backFilesList} for:item="file">
                            <div key={file.id} class="uploaded-file-row">
                                <template if:true={file.isImage}>
                                    <img src={file.preview} class="preview-thumb-sm" alt={file.name} />
                                </template>
                                <template if:false={file.isImage}>
                                    <div class="uploaded-file-icon">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round">
                                            <path d="M13 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V9z"/>
                                            <polyline points="13 2 13 9 20 9"/>
                                        </svg>
                                    </div>
                                </template>
                                <div class="uploaded-file-info">
                                    <div class="uploaded-file-name">{file.name}</div>
                                    <div class="uploaded-file-size">{file.fileSize}</div>
                                </div>
                                <button class="remove-btn" onclick={delBackFile} data-index={file.id}>âœ•</button>
                            </div>
                        </template>
                    </template>

                    <!-- Upload zone if no file -->
                    <template if:false={hasBackFile}>
                        <template if:true={showBackCamera}>
                            <div class="camera-wrap">
                                <video autoplay playsinline></video>
                                  <button onclick={closeCamera}
                                    class="camera-close-btn"
                                    title="Close camera">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" style="width:14px;height:14px">
                                        <line x1="18" y1="6" x2="6" y2="18"/>
                                        <line x1="6" y1="6" x2="18" y2="18"/>
                                    </svg>
                                </button>
                                <template if:true={showCaptureIcon}>
                                    <button class="snap-btn" onclick={takeBackPhoto}></button>
                                    <button class="swap-btn" onclick={handleCameraSwap}>
                                        <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round">
                                            <path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/>
                                            <circle cx="12" cy="13" r="4"/>
                                        </svg>
                                    </button>
                                </template>
                                <canvas class="slds-hide"></canvas>
                            </div>
                        </template>
                        <template if:false={showBackCamera}>
                            <div class="upload-zone-wrapper indented">
                                <div class="upload-zone-content small">
                                    <div class="upload-icon-sm">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                                            <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                                            <polyline points="17 8 12 3 7 8"/>
                                            <line x1="12" y1="3" x2="12" y2="15"/>
                                        </svg>
                                    </div>
                                    <div class="upload-text-primary sm"><span>Choose a file</span></div>
                                    <div class="upload-text-secondary">JPG, PNG or PDF â€” max 5 MB</div>
                                </div>
                                <input class="file-input-overlay" type="file" accept=".jpg,.jpeg,.png,.pdf" onchange={handleBackFileUploadChange} />
                            </div>
                            <div class="or-row indented">
                                <div class="divider-line"></div>
                                <span class="divider-or">or</span>
                                <div class="divider-line"></div>
                            </div>
                            <div style="display:flex;justify-content:center;">
                                <button class="capture-btn indented" onclick={captureBackImage}>
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" style="width:13px;height:13px">
                                        <path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/>
                                        <circle cx="12" cy="13" r="4"/>
                                    </svg>
                                    Take a photo
                                </button>
                            </div>
                        </template>
                    </template>
                </div>
            </div>

            <!-- Guidelines -->
            <div class="custom-card">
                <div class="card-body">
                    <div class="guidelines-title">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--connect-green)" stroke-width="2" stroke-linecap="round">
                            <rect x="3" y="3" width="18" height="18" rx="2"/><path d="M8 12l3 3 5-5"/>
                        </svg>
                        Photo guidelines
                    </div>
                    <template for:each={guidelines} for:item="g">
                        <div key={g} class="guideline-item">
                            <div class="guideline-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                                    <path d="M5 12l5 5L20 7"/>
                                </svg>
                            </div>
                            <div class="guideline-text">{g}</div>
                        </div>
                    </template>
                </div>
            </div>

            <!-- <div class="powered-by">Powered by <strong>Connect</strong></div> -->
        </div>
    </template>

    </div>
</template>